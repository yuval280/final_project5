if(typeof PhpDebugBar>"u"){var PhpDebugBar={};PhpDebugBar.$=jQuery}(function(s){typeof localStorage>"u"&&(localStorage={setItem:function(t,e){},getItem:function(t){return null}}),typeof PhpDebugBar.utils>"u"&&(PhpDebugBar.utils={});var m=PhpDebugBar.utils.getDictValue=function(t,e,i){for(var a=t,o=e.split("."),r=0;r<o.length;r++){if(!a[o[r]])return i;a=a[o[r]]}return a},u=PhpDebugBar.utils.getObjectSize=function(t){if(Object.keys)return Object.keys(t).length;var e=0;for(var i in t)t.hasOwnProperty(i)&&e++;return e};PhpDebugBar.utils.csscls=function(t,e){if(t.indexOf(" ")>-1){for(var i=t.split(" "),a=[],o=0,r=i.length;o<r;o++)a.push(PhpDebugBar.utils.csscls(i[o],e));return a.join(" ")}return t.indexOf(".")===0?"."+e+t.substr(1):e+t},PhpDebugBar.utils.makecsscls=function(t){var e=function(i){return PhpDebugBar.utils.csscls(i,t)};return e};var n=PhpDebugBar.utils.makecsscls("phpdebugbar-"),l=PhpDebugBar.Widget=function(t){this._attributes=s.extend({},this.defaults),this._boundAttributes={},this.$el=s("<"+this.tagName+" />"),this.className&&this.$el.addClass(this.className),this.initialize.apply(this,[t||{}]),this.render.apply(this)};s.extend(l.prototype,{tagName:"div",className:null,defaults:{},initialize:function(t){this.set(t)},render:function(){},set:function(t,e){if(typeof t!="string"){for(var i in t)this.set(i,t[i]);return}if(this._attributes[t]=e,typeof this._boundAttributes[t]<"u")for(var a=0,o=this._boundAttributes[t].length;a<o;a++)this._boundAttributes[t][a].apply(this,[e])},has:function(t){return typeof this._attributes[t]<"u"&&this._attributes[t]!==null},get:function(t){return this._attributes[t]},bindAttr:function(t,e){if(Array.isArray(t)){for(var i=0,a=t.length;i<a;i++)this.bindAttr(t[i],e);return}if(typeof this._boundAttributes[t]>"u"&&(this._boundAttributes[t]=[]),typeof e=="object"){var o=e;e=function(r){o.text(r||"")}}this._boundAttributes[t].push(e),this.has(t)&&e.apply(this,[this._attributes[t]])}}),l.extend=function(t){var e=this,i=function(){return e.apply(this,arguments)};s.extend(i,e);var a=function(){this.constructor=i};return a.prototype=e.prototype,i.prototype=new a,s.extend(i.prototype,t),i.__super__=e.prototype,i};var c=l.extend({className:n("panel"),render:function(){this.$tab=s("<a />").addClass(n("tab")),this.$icon=s("<i />").appendTo(this.$tab),this.bindAttr("icon",function(t){t?this.$icon.attr("class","phpdebugbar-fa phpdebugbar-fa-"+t):this.$icon.attr("class","")}),this.bindAttr("title",s("<span />").addClass(n("text")).appendTo(this.$tab)),this.$badge=s("<span />").addClass(n("badge")).appendTo(this.$tab),this.bindAttr("badge",function(t){t!==null?(this.$badge.text(t),this.$badge.addClass(n("visible"))):this.$badge.removeClass(n("visible"))}),this.bindAttr("widget",function(t){this.$el.empty().append(t.$el)}),this.bindAttr("data",function(t){this.has("widget")&&(this.get("widget").set("data",t),this.$tab.attr("data-empty",s.isEmptyObject(t)||t.count===0))})}}),f=l.extend({tagName:"span",className:n("indicator"),render:function(){this.$icon=s("<i />").appendTo(this.$el),this.bindAttr("icon",function(t){t?this.$icon.attr("class","phpdebugbar-fa phpdebugbar-fa-"+t):this.$icon.attr("class","")}),this.bindAttr("link",function(t){t?this.$el.on("click",()=>{this.get("debugbar").showTab(t)}).css("cursor","pointer"):this.$el.off("click",!1).css("cursor","")}),this.bindAttr(["title","data"],s("<span />").addClass(n("text")).appendTo(this.$el)),this.$tooltip=s("<span />").addClass(n("tooltip disabled")).appendTo(this.$el),this.bindAttr("tooltip",function(t){if(t){var e=s("<dl />");Array.isArray(t)||typeof t=="object"?(s.each(t,function(i,a){s("<dt />").text(i).appendTo(e),s("<dd />").text(a).appendTo(e)}),this.$tooltip.html(e).removeClass(n("disabled"))):this.$tooltip.text(t).removeClass(n("disabled"))}else this.$tooltip.addClass(n("disabled"))})}}),v=l.extend({tagName:"form",className:n("settings"),settings:{},initialize:function(t){this.set(t);var e=this.get("debugbar");this.settings=JSON.parse(localStorage.getItem("phpdebugbar-settings"))||{},s.each(e.options,(i,a)=>{i in this.settings&&(e.options[i]=this.settings[i]),i==="theme"?e.setTheme(e.options[i]):e.$el.attr("data-"+i,e.options[i])})},clearSettings:function(){var t=this.get("debugbar");if(localStorage.removeItem("phpdebugbar-settings"),localStorage.removeItem("phpdebugbar-ajaxhandler-autoshow"),this.settings={},t.options={...t.defaultOptions},t.ajaxHandler){var e=t.ajaxHandler.defaultAutoShow;t.ajaxHandler.setAutoShow(e),this.set("autoshow",e),t.controls.__datasets&&t.controls.__datasets.get("widget").set("autoshow",s(this).is(":checked"))}this.initialize(t.options)},storeSetting:function(t,e){this.settings[t]=e;var i=this.get("debugbar");i.options[t]=e,t!=="theme"&&i.$el.attr("data-"+t,e),localStorage.setItem("phpdebugbar-settings",JSON.stringify(this.settings))},render:function(){this.$el.empty();var t=this.get("debugbar"),e=this,i={};i.Theme=s('<select><option value="auto">Auto (System preference)</option><option value="light">Light</option><option value="dark">Dark</option></select>').val(t.options.theme).on("change",function(){e.storeSetting("theme",s(this).val()),t.setTheme(s(this).val())}),i["Open Button Position"]=s('<select><option value="bottomLeft">Bottom Left</option><option value="bottomRight">Bottom Right</option><option value="topLeft">Top Left</option><option value="topRight">Top Right</option></select>').val(t.options.openBtnPosition).on("change",function(){e.storeSetting("openBtnPosition",s(this).val())}),this.$hideEmptyTabs=s("<input type=checkbox>").prop("checked",t.options.hideEmptyTabs).on("click",function(){e.storeSetting("hideEmptyTabs",s(this).is(":checked"))}),i["Hide Empty Tabs"]=s("<label/>").append(this.$hideEmptyTabs,"Hide empty tabs until they have data"),this.$autoshow=s("<input type=checkbox>").prop("checked",t.ajaxHandler&&t.ajaxHandler.autoShow).on("click",function(){t.ajaxHandler&&t.ajaxHandler.setAutoShow(s(this).is(":checked")),t.controls.__datasets&&t.controls.__datasets.get("widget").set("autoshow",s(this).is(":checked"))}),this.bindAttr("autoshow",function(){this.$autoshow.prop("checked",this.get("autoshow")).closest(".form-row").show()}),i.Autoshow=s("<label/>").append(this.$autoshow,"Automatically show new incoming Ajax requests"),i["Reset to defaults"]=s("<button>Reset settings</button>").on("click",function(a){a.preventDefault(),e.clearSettings(),e.render()}),s.each(i,function(a,o){s("<div />").addClass(n("form-row")).append(s("<div />").addClass(n("form-label")).text(a),s("<div />").addClass(n("form-input")).html(o)).appendTo(e.$el)}),this.ajaxHandler||this.$autoshow.closest(".form-row").hide()}}),b=PhpDebugBar.DatasetTitleFormater=function(t){this.debugbar=t};s.extend(b.prototype,{format:function(t,e,i,o){i?i=" "+i:i="";var o=o||u(this.debugbar.datasets);if(typeof e.__meta>"u")return"#"+o+i;var r=e.__meta.uri.split("/"),h=r.pop();h||(h=(r.pop()||"")+"/"),r.length&&!isNaN(h)&&(h=r.pop()+"/"+h);var d=150;h.length>d&&(h=h.substr(0,d)+"...");var p="#"+o+" "+h+i+" ("+e.__meta.datetime.split(" ")[1]+")";return p}});var g=PhpDebugBar.DebugBar=l.extend({className:"phpdebugbar "+n("minimized"),options:{bodyMarginBottom:!0,theme:"auto",openBtnPosition:"bottomLeft",hideEmptyTabs:!1},initialize:function(t={}){this.options=s.extend(this.options,t),this.defaultOptions={...this.options},this.controls={},this.dataMap={},this.datasets={},this.firstTabName=null,this.activePanelName=null,this.activeDatasetId=null,this.datesetTitleFormater=new b(this),this.bodyMarginBottomHeight=parseInt(s("body").css("margin-bottom"));try{this.isIframe=window.self!==window.top&&window.top.phpdebugbar}catch{this.isIframe=!1}this.registerResizeHandler(),this.registerMediaListener(),this.settings=new PhpDebugBar.DebugBar.Tab({icon:"sliders",title:"Settings",widget:new v({debugbar:this})})},registerResizeHandler:function(){if(!(typeof this.resize.bind>"u"||this.isIframe)){var t=this.resize.bind(this);this.respCSSSize=0,s(window).resize(t),setTimeout(t,20)}},registerMediaListener:function(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{this.options.theme==="auto"&&this.setTheme("auto")})},setTheme:function(t){this.options.theme=t,t==="auto"&&(t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),this.$el.attr("data-theme",t),this.openHandler&&this.openHandler.$el.attr("data-theme",t)},resize:function(){if(!this.isIframe){var t=this.respCSSSize;this.respCSSSize==0&&this.$header.find("> *:visible").each(function(){t+=s(this).outerWidth(!0)});var e=this.$header.width(),i=n("mini-design"),a=this.$header.hasClass(i);e<=t&&!a?(this.respCSSSize=t,this.$header.addClass(i)):t<e&&a&&(this.respCSSSize=0,this.$header.removeClass(i)),this.setHeight(this.$body.height())}},render:function(){this.isIframe&&this.$el.hide();var t=this;this.$el.appendTo("body"),this.$dragCapture=s("<div />").addClass(n("drag-capture")).appendTo(this.$el),this.$resizehdle=s("<div />").addClass(n("resize-handle")).appendTo(this.$el),this.$header=s("<div />").addClass(n("header")).appendTo(this.$el),this.$headerBtn=s("<a />").addClass(n("restore-btn")).appendTo(this.$header),this.$headerBtn.click(function(){t.close()}),this.$headerLeft=s("<div />").addClass(n("header-left")).appendTo(this.$header),this.$headerRight=s("<div />").addClass(n("header-right")).appendTo(this.$header);var e=this.$body=s("<div />").addClass(n("body")).appendTo(this.$el);this.recomputeBottomOffset();var i,a;this.$resizehdle.on("mousedown",function(h){a=e.height(),i=h.pageY,e.parents().on("mousemove",o).on("mouseup",r),t.$dragCapture.show(),h.preventDefault()});var o=function(h){var d=a+(i-h.pageY);t.setHeight(d)},r=function(){e.parents().off("mousemove",o).off("mouseup",r),t.$dragCapture.hide()};this.$closebtn=s("<a />").addClass(n("close-btn")).appendTo(this.$headerRight),this.$closebtn.click(function(){t.close()}),this.$minimizebtn=s("<a />").addClass(n("minimize-btn")).appendTo(this.$headerRight),this.$minimizebtn.click(function(){t.minimize()}),this.$maximizebtn=s("<a />").addClass(n("maximize-btn")).appendTo(this.$headerRight),this.$maximizebtn.click(function(){t.restore()}),this.$restorebtn=s("<a />").addClass(n("restore-btn")).hide().appendTo(this.$el),this.$restorebtn.click(function(){t.restore()}),this.$openbtn=s("<a />").addClass(n("open-btn")).appendTo(this.$headerRight).hide(),this.$openbtn.click(function(){t.openHandler.show(function(h,d){t.addDataSet(d,h,"(opened)"),t.showTab()})}),this.$datasets=s("<select />").addClass(n("datasets-switcher")).attr("name","datasets-switcher").appendTo(this.$headerRight),this.$datasets.change(function(){t.showDataSet(this.value)}),this.controls.__settings=this.settings,this.settings.$tab.addClass(n("tab-settings")),this.settings.$tab.attr("data-collector","__settings"),this.settings.$el.attr("data-collector","__settings"),this.settings.$tab.insertAfter(this.$minimizebtn).show(),this.settings.$tab.click(()=>{!this.isMinimized()&&this.activePanelName=="__settings"?this.minimize():(this.showTab("__settings"),this.settings.get("widget").render())}),this.settings.$el.appendTo(this.$body)},setHeight:function(t){var e=40,i=s(window).innerHeight()-this.$header.height()-10;t=Math.min(t,i),t=Math.max(t,e),this.$body.css("height",t),localStorage.setItem("phpdebugbar-height",t),this.recomputeBottomOffset()},restoreState:function(){if(!this.isIframe){var t=localStorage.getItem("phpdebugbar-height");this.setHeight(t||this.$body.height());var e=localStorage.getItem("phpdebugbar-open");if(e&&e=="0")this.close();else{var i=localStorage.getItem("phpdebugbar-visible");if(i&&i=="1"){var a=localStorage.getItem("phpdebugbar-tab");this.isTab(a)?this.showTab(a):this.showTab()}}}},createTab:function(t,e,i){var a=new c({title:i||t.replace(/[_\-]/g," ").charAt(0).toUpperCase()+t.slice(1),widget:e});return this.addTab(t,a)},addTab:function(t,e){if(this.isControl(t))throw new Error(t+" already exists");var i=this;return e.$tab.appendTo(this.$headerLeft).click(function(){!i.isMinimized()&&i.activePanelName==t?i.minimize():i.showTab(t)}),e.$tab.attr("data-empty",!0),e.$tab.attr("data-collector",t),e.$el.attr("data-collector",t),e.$el.appendTo(this.$body),this.controls[t]=e,this.firstTabName==null&&(this.firstTabName=t),e},createIndicator:function(t,e,i,a){var o=new f({icon:e,tooltip:i});return this.addIndicator(t,o,a)},addIndicator:function(t,e,i){if(this.isControl(t))throw new Error(t+" already exists");return e.set("debugbar",this),i=="left"?e.$el.insertBefore(this.$headerLeft.children().first()):e.$el.appendTo(this.$headerRight),this.controls[t]=e,e},getControl:function(t){if(this.isControl(t))return this.controls[t]},isControl:function(t){return typeof this.controls[t]<"u"},isTab:function(t){return this.isControl(t)&&this.controls[t]instanceof c},isIndicator:function(t){return this.isControl(t)&&this.controls[t]instanceof f},reset:function(){this.minimize();var t=this;s.each(this.controls,function(e,i){t.isTab(e)&&i.$tab.remove(),i.$el.remove()}),this.controls={}},showTab:function(t){if(t||(this.activePanelName?t=this.activePanelName:t=this.firstTabName),!this.isTab(t))throw new Error("Unknown tab '"+t+"'");this.$resizehdle.show(),this.$body.show(),this.recomputeBottomOffset(),s(this.$header).find("> div > ."+n("active")).removeClass(n("active")),s(this.$body).find("> ."+n("active")).removeClass(n("active")),this.controls[t].$tab.addClass(n("active")),this.controls[t].$el.addClass(n("active")),this.activePanelName=t,this.$el.removeClass(n("minimized")),localStorage.setItem("phpdebugbar-visible","1"),localStorage.setItem("phpdebugbar-tab",t),this.resize()},minimize:function(){this.$header.find("> div > ."+n("active")).removeClass(n("active")),this.$body.hide(),this.$resizehdle.hide(),this.recomputeBottomOffset(),localStorage.setItem("phpdebugbar-visible","0"),this.$el.addClass(n("minimized")),this.resize()},isMinimized:function(){return this.$el.hasClass(n("minimized"))},close:function(){this.$resizehdle.hide(),this.$header.hide(),this.$body.hide(),this.$restorebtn.show(),localStorage.setItem("phpdebugbar-open","0"),this.$el.addClass(n("closed")),this.recomputeBottomOffset()},isClosed:function(){return this.$el.hasClass(n("closed"))},restore:function(){this.$resizehdle.show(),this.$header.show(),this.$restorebtn.hide(),localStorage.setItem("phpdebugbar-open","1");var t=localStorage.getItem("phpdebugbar-tab");this.isTab(t)?this.showTab(t):this.showTab(),this.$el.removeClass(n("closed")),this.resize()},recomputeBottomOffset:function(){if(this.options.bodyMarginBottom){if(this.isClosed())return s("body").css("margin-bottom",this.bodyMarginBottomHeight||"");var t=parseInt(this.$el.height())+(this.bodyMarginBottomHeight||0);s("body").css("margin-bottom",t)}},setDataMap:function(t){this.dataMap=t},addDataMap:function(t){s.extend(this.dataMap,t)},setData:function(t){return this.datasets={},this.addDataSet(t)},addDataSet:function(t,e,i,a){if(!(!t||!t.__meta)){if(this.isIframe){window.top.phpdebugbar.addDataSet(t,e,"(iframe)"+(i||""),a);return}var o=u(this.datasets)+1;e=e||o,t.__meta.nb=o,t.__meta.suffix=i,this.datasets[e]=t;var r=this.datesetTitleFormater.format(e,this.datasets[e],i,o);if(this.datasetTab){this.datasetTab.set("data",this.datasets);var h=u(this.datasets);this.datasetTab.set("badge",h>1?h:null),this.datasetTab.$tab.show()}return this.$datasets.append(s('<option value="'+e+'">'+r+"</option>")),this.$datasets.children().length>1&&this.$datasets.show(),(typeof a>"u"||a)&&this.showDataSet(e),this.resize(),e}},loadDataSet:function(t,e,i,a){if(!this.openHandler)throw new Error("loadDataSet() needs an open handler");var o=this;this.openHandler.load(t,function(r){o.addDataSet(r,t,e,a),o.resize(),i&&i(r)})},getDataSet:function(t){return this.datasets[t]},showDataSet:function(t){this.activeDatasetId=t,this.dataChangeHandler(this.datasets[t]),this.$datasets.val()!==t&&this.$datasets.val(t),this.datasetTab&&this.datasetTab.get("widget").set("id",t)},dataChangeHandler:function(t){var e=this;s.each(this.dataMap,function(i,a){var o=m(t,a[0],a[1]);i.indexOf(":")!=-1?(i=i.split(":"),e.getControl(i[0]).set(i[1],o)):e.getControl(i).set("data",o)}),e.resize()},setOpenHandler:function(t){this.openHandler=t,this.openHandler.$el.attr("data-theme",this.$el.attr("data-theme")),t!==null?this.$openbtn.show():this.$openbtn.hide()},getOpenHandler:function(){return this.openHandler},enableAjaxHandlerTab:function(){this.datasetTab=new PhpDebugBar.DebugBar.Tab({icon:"history",title:"Request history",widget:new PhpDebugBar.Widgets.DatasetWidget({debugbar:this})}),this.datasetTab.$tab.addClass(n("tab-history")),this.datasetTab.$tab.attr("data-collector","__datasets"),this.datasetTab.$el.attr("data-collector","__datasets"),this.datasetTab.$tab.insertAfter(this.$openbtn).hide(),this.datasetTab.$tab.click(()=>{!this.isMinimized()&&this.activePanelName=="__datasets"?this.minimize():this.showTab("__datasets")}),this.datasetTab.$el.appendTo(this.$body),this.controls.__datasets=this.datasetTab}});g.Tab=c,g.Indicator=f;var w=PhpDebugBar.AjaxHandler=function(t,e,i){this.debugbar=t,this.headerName=e||"phpdebugbar",this.autoShow=typeof i>"u"?!0:i,this.defaultAutoShow=this.autoShow,localStorage.getItem("phpdebugbar-ajaxhandler-autoshow")!==null&&(this.autoShow=localStorage.getItem("phpdebugbar-ajaxhandler-autoshow")=="1"),t.controls.__settings&&t.controls.__settings.get("widget").set("autoshow",this.autoShow)};s.extend(w.prototype,{handle:function(t){return this.isFetch(t)&&!t.headers.has(this.headerName+"-id")||this.isXHR(t)&&t.getAllResponseHeaders().indexOf(this.headerName)===-1||this.loadFromId(t)?!0:this.loadFromData(t)},getHeader:function(t,e){return this.isFetch(t)?t.headers.get(e):t.getResponseHeader(e)},isFetch:function(t){return Object.prototype.toString.call(t)=="[object Response]"},isXHR:function(t){return Object.prototype.toString.call(t)=="[object XMLHttpRequest]"},setAutoShow:function(t){this.autoShow=t,localStorage.setItem("phpdebugbar-ajaxhandler-autoshow",t?"1":"0")},loadFromId:function(t){var e=this.extractIdFromHeaders(t);return e&&this.debugbar.openHandler?(this.debugbar.loadDataSet(e,"(ajax)",void 0,this.autoShow),!0):!1},extractIdFromHeaders:function(t){return this.getHeader(t,this.headerName+"-id")},loadFromData:function(t){var e=this.extractDataFromHeaders(t);if(!e)return!1;var i=this.parseHeaders(e);if(i.error)throw new Error("Error loading debugbar data: "+i.error);return i.data&&this.debugbar.addDataSet(i.data,i.id,"(ajax)",this.autoShow),!0},extractDataFromHeaders:function(t){var e=this.getHeader(t,this.headerName);if(e){for(var i=1;;i++){var a=this.getHeader(t,this.headerName+"-"+i);if(!a)break;e+=a}return decodeURIComponent(e)}},parseHeaders:function(t){return JSON.parse(t)},bindToFetch:function(){var t=this,e=window.fetch;e!==void 0&&e.polyfill!==void 0||(window.fetch=function(){var i=e.apply(this,arguments);return i.then(function(a){t.handle(a)}).catch(function(a){}),i})},bindToJquery:function(t){var e=this;t(document).ajaxComplete(function(i,a,o){o.ignoreDebugBarAjaxHandler||e.handle(a)})},bindToXHR:function(){var t=this,e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(i,a,o,r,h){var d=this;this.addEventListener("readystatechange",function(){var p=t.debugbar.openHandler?t.debugbar.openHandler.get("url"):null,T=typeof a=="string"?a:a.href;d.readyState==4&&T.indexOf(p)!==0&&t.handle(d)},!1),e.apply(this,Array.prototype.slice.call(arguments))}}})})(PhpDebugBar.$);
